# 掃描輸出顯示設計文件

> **版本**: v1.0  
> **更新日期**: 2024-12-19  

---

## 1. 概述

本文件定義台灣股市分析系統中所有掃描功能的輸出顯示規範，確保使用者體驗一致性與可讀性。

---

## 2. 通用輸出結構

### 2.1 標準掃描輸出流程

```
[執行開始]
    ↓
[篩選過程顯示] ← 漏斗式層層篩選
    ↓
[結果表格顯示] ← 表格化呈現
    ↓
[說明區域]     ← 策略說明與操作建議
    ↓
[互動提示]     ← 輸入股號查詢或返回
```

### 2.2 輸出區塊規範

| 區塊 | 寬度 | 分隔符 | 用途 |
|------|------|--------|------|
| 標題區 | 60 字元 | `═` | 掃描策略名稱 |
| 分隔線 | 60 字元 | `─` | 區塊分隔 |
| 結果表格 | 80 字元 | `-` | 欄位對齊 |

---

## 3. 篩選過程顯示 (漏斗式)

### 3.1 格式範例

```
============================================================
[篩選過程] 【策略名稱】
============================================================
總股數: 1768
────────────────────────────────────────────────────────────
✓ 第1層篩選條件        → XXX 檔
✓ 第2層篩選條件        → XXX 檔
✓ 第3層篩選條件        → XXX 檔
────────────────────────────────────────────────────────────
```

### 3.2 符號規範

| 符號 | 意義 | 使用情境 |
|------|------|----------|
| `✓` | 通過/完成 | 篩選條件通過 |
| `✗` | 不通過 | 條件未達標 |
| `→` | 導向結果 | 顯示篩選後數量 |
| `•` | 列表項目 | 子項目或訊號統計 |

---

## 4. 結果表格顯示

### 4.1 標準欄位配置 (統一格式)

所有掃描結果表格採用統一的欄位順序：

```
代號   名稱     收盤    成交量(量能比)  VSBC上/下  VP上/下  [策略專屬欄位]
--------------------------------------------------------------------------------
2330   台積電   585.00  45,678(1.35x)  60/120    440/560   ...
```

### 4.2 欄位寬度規範

| 欄位 | 寬度 | 對齊 | 格式範例 |
|------|------|------|----------|
| 代號 | 6 | 左 | `2330` |
| 名稱 | 10 | 左 | `台積電` |
| 收盤 | 10 | 右 | `585.00` |
| 成交量(量能比) | 18 | 右 | `45,678(1.35x)` |
| VSBC上/下 | 12 | 右 | `60/120` |
| VP上/下 | 12 | 右 | `440/560` |

### 4.3 顏色規範

#### 4.3.1 ANSI 顏色代碼

| 數值類型 | 顏色 | ANSI Code | 說明 |
|----------|------|-----------|------|
| 上漲/正值 | 紅色 | `\033[91m` | 亮紅色 |
| 下跌/負值 | 綠色 | `\033[92m` | 亮綠色 |
| 漲停 (≥+9.5%) | 白字紅底 | `\033[97;41m` | 滿版背景 |
| 跌停 (≤-9.5%) | 白字綠底 | `\033[97;42m` | 滿版背景 |
| 爆量 (≥2.0x) | 紫色 | `\033[95m` | 特殊標示 |
| 量增 (>1.0x) | 紅色 | `\033[91m` | 活躍 |
| 量縮 (<1.0x) | 綠色 | `\033[92m` | 低迷 |
| 標題 | 黃色 | `\033[93m` | 區塊標題 |
| 重要提示 | 青色 | `\033[96m` | 系統訊息 |
| 重設 | - | `\033[0m` | 恢復預設 |

#### 4.3.2 各數值顏色規則

| 數值 | 條件 | 顏色 |
|------|------|------|
| 收盤價漲跌幅 | ≥ +9.5% | 白字紅底 (漲停) |
| | > 0% | 紅字 |
| | < 0% | 綠字 |
| | ≤ -9.5% | 白字綠底 (跌停) |
| 14日漲跌幅 (CHG14) | 正值 | 紅字 |
| | 負值 | 綠字 |
| 成交量 (量能比) | ≥ 2.0x | 紫字 (爆量) |
| | > 1.0x | 紅字 (量增) |
| | < 1.0x | 綠字 (量縮) |
| MFI/VWAP 趨勢 | 上升 (↑) | 紅字 |
| | 下降 (↓) | 綠字 |

#### 4.3.3 相關函數

- `get_color_code(val)` — 漲跌顏色 (含漲停/跌停判斷)
- `get_volume_color(ratio)` — 成交量顏色
- `get_trend_color(curr, prev)` — 趨勢顏色
- `get_colored_value(text, change, arrow)` — 帶色數值格式化

---

## 5. 各策略輸出規範

### 5.1 聰明錢掃描 (`scan_smart_money_strategy`)

**專屬輸出區塊：**
```
【各項訊號統計】(通過成交量門檻者)
  • NVI 趨勢 (NVI>200MA)    → XX 檔
  • NVI > PVI (多頭排列)    → XX 檔
  • 無背離 (價高NVI高)      → XX 檔
  • 價格趨勢 (價>200MA)     → XX 檔
────────────────────────────────────────
【Smart Score 分布】(滿分6分)
  • Score >= 4 (買入訊號)   → XX 檔
  • Score >= 5 (強烈買入)   → XX 檔
  • Score >= 6 (極強訊號)   → XX 檔
```

**結果表格欄位：**
```
代號   名稱     收盤       NVI值      NVI/MA    分數    風險      建議
```

---

### 5.2 VSBC 籌碼策略 (`scan_vsbc_strategy`)

**分類輸出：**
```
============================================================
【穩健型】 (大象起舞)
代號   名稱     收盤       ma20(乖離%)    成交量 60mv(倍數) VSBC上/下
──────────────────────────────────────────────────────────

============================================================
【爆發型】 (底部轉機)
...

============================================================
【趨勢型】 (強者恆強)
...
```

---

### 5.3 均線多頭掃描 (`scan_ma_alignment_rising`)

**專屬顯示：**
```
【均線多頭】四線上揚+股價在上+0-10%
代號   名稱     收盤       MA5↗    MA20↗   MA60↗   MA120↗
──────────────────────────────────────────────────────────
2330   台積電   585.00    ✓       ✓       ✓       ✓
```

**額外資訊函數輸出：**
```
WMA20:580.00 WMA60:565.00 WMA120:545.00 WMA200:520.00 [距WMA200:12.5%]
```

---

### 5.4 月KD交叉掃描 (`execute_kd_golden_scan`)

**結果格式：**
```
月KD交叉: 找到 XX 檔符合條件的股票 (顯示前30檔)
排序方式: K值由小到大 (0% -> 100%)
```

**額外資訊：**
```
[K↑穿越D↑ MK:45.2 MD:42.8]
```

---

### 5.5 2560 戰法掃描 (`scan_2560_strategy`)
   
**結果格式：**
```
【2560 戰法 TOP】 (前 30 筆)
代號     名稱       收盤         成交量(量比)          MA25       量MA5       量MA60      訊號
------------------------------------------------------------------------------------------
4729   熒茂       22.60      2753張(9.1)            20.59        678          301          買入
1103   嘉泥       14.20      1288張(3.7)            13.86        498          345          買入
```

**策略說明：**
```
2560戰法: 收盤價 > MA25 且 成交量 > VolMA5 且 成交量 > VolMA60 (三線共振)
```

---

### 5.6 量價背離分析 (`scan_pv_divergence_analysis`)

**四種方法顯示：**
```
【量價背離綜合分析】
────────────────────────────────────────
方法1: 直接比較法
  • 價漲量縮: ✓/✗
  • 連續天數: X 天

方法2: 趨勢回歸法
  • 價格斜率: +0.XX
  • 成交量斜率: -0.XX

方法3: 短均線斜率背離法
  • 價格趨勢強度: 強上升/弱下降
  • 成交量趨勢強度: 強下降

方法4: MFI背離法
  • 價格MFI: XX.X (超買/超賣/正常)
  • 成交量MFI: XX.X

────────────────────────────────────────
【綜合評分】
看漲背離次數: X/4
看跌背離次數: X/4
主要信號: 看漲背離/看跌背離/無明確背離
信號強度: XX%
交易建議: XXXXXX
```

---

## 6. 互動提示規範

### 6.1 標準提示

```
────────────────────────────────────────────────────────────
輸入股票代號 (如 2330) 可查看詳情，按 Enter 返回: 
```

### 6.2 禁止事項

- ❌ 不得出現「按任意鍵繼續」
- ❌ 不得出現多餘的確認提示
- ✓ 一律直接返回或等待股號輸入

---

## 7. 核心輸出函數

### 7.1 `display_scan_results()`

**參數：**
| 參數 | 類型 | 說明 |
|------|------|------|
| `results` | List[Tuple] | 掃描結果清單 |
| `title` | str | 表格標題 |
| `limit` | int | 顯示數量上限 |
| `extra_info_func` | Callable | 額外資訊產生函數 |
| `description` | str | 策略說明文字 |

**輸出格式：**
```python
def display_scan_results(results, title, limit=30, extra_info_func=None, description=""):
    """
    統一掃描結果顯示函數
    
    輸出結構：
    1. 標題列 (策略名稱)
    2. 欄位標頭
    3. 分隔線
    4. 資料列 (依 limit 限制)
    5. 分隔線
    6. 說明區
    7. 互動提示
    """
```

### 7.2 `prompt_stock_detail_report()`

**功能：** 掃描結束後的互動提示，讓使用者輸入股號查詢詳情

---

## 8. 統一輸出類別 (`StepOutput`)

### 8.1 可用方法

| 方法 | 用途 | 範例 |
|------|------|------|
| `header(title)` | 區塊標題 | `═══ 標題 ═══` |
| `success(msg)` | 成功訊息 | `✓ 完成` |
| `warn(msg)` | 警告訊息 | `⚠ 注意` |
| `error(msg)` | 錯誤訊息 | `❌ 失敗` |
| `progress(cur, total)` | 進度顯示 | `[50/100]` |

---

## 9. 完整輸出範例

### 9.1 聰明錢掃描完整範例

```
正在掃描 聰明錢指標 (NVI主力籌碼)...
條件: 成交量 > 昨日x1.1, 價格 > MA200, MFI < 80

============================================================
[篩選過程] 聰明錢指標多層篩選 (NVI版)
============================================================
總股數: 1881
────────────────────────────────────────────────────────────
✓ 成交量 >= 100張            → 1256 檔
────────────────────────────────────────────────────────────
【各項訊號統計】(通過成交量門檻者)
  • NVI 趨勢 (NVI>200MA)    → 523 檔
  • NVI > PVI (多頭排列)    → 412 檔
  • 無背離 (價高NVI高)      → 678 檔
  • 價格趨勢 (價>200MA)     → 534 檔
  • 無量價背離 (新)         → 489 檔
  • 週線NVI趨勢 (新)        → 367 檔
────────────────────────────────────────────────────────────
【Smart Score 分布】(滿分6分)
  • Score >= 4 (買入訊號)   → 156 檔
  • Score >= 5 (強烈買入)   → 78 檔
  • Score >= 6 (極強訊號)   → 23 檔
============================================================

【聰明錢掃描結果 (NVI版)】 (前 30 筆)
#    代號   名稱           收盤       成交量(張)   Score   NVI值      建議
--------------------------------------------------------------------------------
1    2330   台積電         1085.00    45,678       6       125.5      強力買進
2    2454   聯發科         1520.00    12,345       6       118.3      強力買進
3    3008   大立光         2150.00     3,456       5       112.7      積極買進
4    2317   鴻海            178.50    28,765       5       108.2      積極買進
5    2382   廣達            285.00    15,432       5       105.8      積極買進
...
--------------------------------------------------------------------------------
聰明錢: 基於 NVI 趨勢、NVI/PVI 關係、無背離、價格趨勢、無量價背離、週線 NVI
之綜合評分 (滿分6分)
────────────────────────────────────────────────────────────
輸入股票代號 (如 2330) 可查看詳情，按 Enter 返回: 
```

---

### 9.2 VSBC 籌碼策略完整範例

```
============================================================
[篩選過程] 【VSBC 籌碼策略】 - 量價/箱型/籌碼
1.60mv>1000張且今日量能 / 60日均量 > 1.3倍。->456檔
2.收盤價距離月線 (20MA) < 12%。-->234檔
3.【穩健型】-->45檔
4.【爆發型】-->28檔
5.【趨勢型】-->67檔
============================================================

============================================================
【穩健型】 (大象起舞)
特徵: 乖離極小 (< 4.5%) + 超大流動性 (> 3000張)
代號   名稱           收盤       ma20(乖離%)    成交量    60mv(倍數)  VSBC上/下
--------------------------------------------------------------------------------
2330   台積電        1085.00    +1.21%         45,678    1.52x       1120/1050
2454   聯發科        1520.00    +0.89%         12,345    1.45x       1580/1460
2317   鴻海           178.50    +2.15%         28,765    1.68x        185/170
--------------------------------------------------------------------------------

============================================================
【爆發型】 (底部轉機)
特徵: 股價在低檔 (區間位置 < 45%) + 爆發性量能 (量比 > 2.0倍)
代號   名稱           收盤       ma20(乖離%)    成交量    60mv(倍數)  VSBC上/下
--------------------------------------------------------------------------------
3034   聯詠            425.00    +3.45%         8,765    2.35x ⚡     450/400
2379   瑞昱            485.00    +2.89%         6,543    2.12x ⚡     510/460
--------------------------------------------------------------------------------

============================================================
【趨勢型】 (強者恆強)
特徵: 不符合上述兩者，但動能強勁
代號   名稱           收盤       ma20(乖離%)    成交量    60mv(倍數)  VSBC上/下
--------------------------------------------------------------------------------
2603   長榮            178.00    +5.67%        125,432   1.89x        190/165
2609   陽明            68.50     +4.23%         87,654   1.76x         75/62
--------------------------------------------------------------------------------

✓ 掃描完成，共找到 140 檔符合條件

輸入股票代號查看詳情，或按 Enter 返回: 
```

---

### 9.3 均線多頭掃描完整範例

```
正在掃描 均線篩選 (四線上揚+股價在上+0-10%)...

============================================================
【均線多頭】四線上揚+股價在上+0-10%
篩選條件:
  ✓ 收盤價在MA20、MA60、MA120、MA200之上 0-10% 之間 -->156檔
============================================================

代號   名稱           收盤       MA5↗    MA20↗   MA60↗   MA120↗  MA200↗
--------------------------------------------------------------------------------
2330   台積電        1085.00    ✓       ✓       ✓       ✓       ✓
       WMA20:1065.00 WMA60:1020.00 WMA120:980.00 WMA200:920.00 [距WMA200:+17.9%]
2454   聯發科        1520.00    ✓       ✓       ✓       ✓       ✓
       WMA20:1485.00 WMA60:1420.00 WMA120:1350.00 WMA200:1280.00 [距WMA200:+18.8%]
3008   大立光        2150.00    ✓       ✓       ✓       ✓       ✓
       WMA20:2080.00 WMA60:1980.00 WMA120:1920.00 WMA200:1850.00 [距WMA200:+16.2%]
--------------------------------------------------------------------------------
條件: 20,60,120,200 全數向上，股價 > 所有均線，距最高均線 0-10%
────────────────────────────────────────────────────────────
✓ 掃描完成，共找到 156 檔符合條件

輸入股票代號 (如 2330) 可查看詳情，按 Enter 返回: 
```

---

### 9.4 月KD交叉掃描完整範例

```
正在掃描 月KD交叉 (K↑穿越D↑ 或 D↑穿越K↑)...

月KD交叉: 找到 45 檔符合條件的股票 (顯示前30檔)
排序方式: K值由小到大 (0% -> 100%)

代號   名稱           收盤       成交量(張)   月K值    月D值    訊號類型
--------------------------------------------------------------------------------
3034   聯詠            425.00     8,765      28.5     25.2    [K↑穿越D↑]
2379   瑞昱            485.00     6,543      35.2     32.8    [K↑穿越D↑]
2308   台達電          385.00    12,345      42.1     39.5    [K↑穿越D↑]
2357   華碩            520.00     5,678      48.7     45.2    [K↑穿越D↑]
...
--------------------------------------------------------------------------------
KD: 隨機指標, K值由下往上穿越D值=黃金交叉 (買進訊號)
────────────────────────────────────────────────────────────
輸入股票代號 (如 2330) 可查看詳情，按 Enter 返回: 
```

---

### 9.5 量價背離分析完整範例

```
正在分析 2330 的量價背離狀態...

============================================================
【量價背離綜合分析】 2330 台積電
============================================================

【方法1: 直接比較法】
  • 價漲量縮: ✓ 偵測到
  • 價跌量縮: ✗
  • 連續天數: 3 天
  • 詳細: 近3天價格上漲但成交量萎縮
────────────────────────────────────────────────────────────

【方法2: 趨勢回歸法】
  • 價格斜率: +2.35 (上升趨勢)
  • 成交量斜率: -0.18 (下降趨勢)
  • 價格R²: 0.85 (強趨勢)
  • 成交量R²: 0.72 (中等趨勢)
  • 結論: ✓ 價漲量縮
────────────────────────────────────────────────────────────

【方法3: 短均線斜率背離法】
  • 價格 MA5 斜率: +1.28
  • 成交量 MA5 斜率: -0.45
  • 價格趨勢強度: 強上升
  • 成交量趨勢強度: 弱下降
  • 結論: ✓ 價漲量縮
────────────────────────────────────────────────────────────

【方法4: MFI背離法】
  • 價格 MFI: 72.5 (超買區)
  • 成交量 MFI: 35.2 (正常)
  • 價格狀態: 超買
  • 成交量狀態: 正常
  • 結論: ✗ 無明確背離
────────────────────────────────────────────────────────────

============================================================
【綜合評分】
看漲背離次數: 0/4
看跌背離次數: 3/4 ⚠️
主要信號: 看跌背離
信號強度: 75%
交易建議: 強烈看跌信號，考慮減倉或觀望
============================================================
```

---

### 9.6 五階篩選器完整範例

```
============================================================
[篩選過程] 五階篩選器 (千問版)
總股數: 1768
────────────────────────────────────────────────────────────
✓ 資料充足 (>100日)       → 1650 檔
✓ 成交量 >= 500張         → 890 檔
✓ [第1階] 相對強度 (RS)   → 456 檔
✓ [第2階] 強勢股條件      → 234 檔 (合格率 51.3%)
✓ [第3階] 主力籌碼驗證    → 156 檔 (合格率 66.7%)
✓ [第4階] 價值區間定位    → 89 檔 (合格率 57.1%)
✓ [第5階] 動能觸發訊號    → 45 檔 (合格率 50.6%)
✓ 綜合評分 >= 60分        → 30 檔 (最終選出)
────────────────────────────────────────────────────────────

【五階篩選 TOP】 (前 30 筆)
#    代號   名稱           收盤       分數     RS值     K值      狀態
--------------------------------------------------------------------------------
1    2330   台積電        1085.00    92.5     1.45     68.5     🔥極強
2    2454   聯發科        1520.00    88.2     1.38     72.3     🔥極強
3    3008   大立光        2150.00    85.7     1.32     65.8     ⚡強勢
4    2317   鴻海           178.50    82.1     1.28     58.2     ⚡強勢
5    2382   廣達           285.00    79.5     1.25     62.5     ⚡強勢
...
30   2357   華碩           520.00    61.2     1.05     45.8     ◆觀望
--------------------------------------------------------------------------------
五階篩選: RS強度 + 趨勢確認 + 籌碼驗證 + 價值定位 + 動能觸發
────────────────────────────────────────────────────────────
輸入股票代號 (如 2330) 可查看詳情，按 Enter 返回: 
```

---

### 9.7 六維共振交易系統完整範例

```
======================================================================
【六維共振交易系統】MACD/KDJ/RSI/LWR/BBI/MTM
  ✓ 資料充足        -->1650檔
  ✓ 成交量 >= 500張  -->890檔
  ✓ 六維共振買入    -->45檔
======================================================================

【共振訊號 TOP】 (前 30 筆，4維以上)
代號   名稱           收盤       訊號    維度   MACD  KDJ  RSI  LWR  BBI  MTM
---------------------------------------------------------------------------
2330   台積電        1085.00    買入     6/6   ✓     ✓    ✓    ✓    ✓    ✓
2454   聯發科        1520.00    買入     6/6   ✓     ✓    ✓    ✓    ✓    ✓
3008   大立光        2150.00    買入     5/6   ✓     ✓    ✓    ✗    ✓    ✓
2317   鴻海           178.50    觀望     4/6   ✓     ✓    ✓    ✗    ✓    ✗
2382   廣達           285.00    觀望     4/6   ✓     ✗    ✓    ✓    ✓    ✗
...
---------------------------------------------------------------------------
六維指標說明:
  MACD: DIF>DEA 且柱狀圖為正
  KDJ: K>D (金叉)
  RSI: >50 (強勢區)
  LWR: <50 (強勢區，反向指標)
  BBI: 價格 > BBI均線
  MTM: 動量 > 0 且 > 動量MA
---------------------------------------------------------------------------
✓ 掃描完成，共找到 45 檔符合條件

輸入股票代號 (如 2330) 可查看詳情，按 Enter 返回: 
```

---

## 10. 最佳實踐

1. **即抓即顯示**：資料下載時立即顯示進度，避免長時間無輸出
2. **表格對齊**：使用固定欄位寬度確保對齊
3. **漏斗式呈現**：先顯示總數，再逐層篩選
4. **說明在後**：結果表格後附上策略說明
5. **一致性**：所有掃描使用相同的輸出框架

---

*文檔更新時間: 2024-12-19*
